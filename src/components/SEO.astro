---
/**
 * SEO 组件
 *
 * 功能：
 * 1. 自动注入 meta 标签（title, description）
 * 2. 生成 canonical URL
 * 3. Open Graph 标签
 * 4. Twitter Card 标签
 * 5. JSON-LD 结构化数据
 *
 * 使用方法：
 * <SEO
 *   title="页面标题"
 *   description="页面描述"
 *   image="/og-image.jpg"
 *   article={true}
 *   pubDatetime={new Date()}
 * />
 */

import { SITE } from "@/config/site.config";
import { OG_CONFIG, TWITTER_CONFIG } from "@/config/seo.config";

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  article?: boolean;
  pubDatetime?: Date;
  modDatetime?: Date;
  author?: string;
  tags?: string[];
  noindex?: boolean;
}

const {
  title = SITE.title,
  description = SITE.desc,
  image = SITE.ogImage,
  canonical,
  article = false,
  pubDatetime,
  modDatetime,
  author = SITE.author,
  tags = [],
  noindex = false,
} = Astro.props;

// 生成完整的页面标题
const pageTitle = title === SITE.title ? title : `${title} | ${SITE.title}`;

// 生成 canonical URL
const canonicalURL = canonical || new URL(Astro.url.pathname, SITE.website).href;

// 生成 OG 图片 URL
const ogImageURL = new URL(image.startsWith("/") ? image : `/${image}`, SITE.website).href;

// 当前页面 URL
const currentURL = new URL(Astro.url.pathname, SITE.website).href;
---

<!-- 基础 Meta 标签 -->
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="canonical" href={canonicalURL} />
<meta name="generator" content={Astro.generator} />

<!-- 主要 Meta 标签 -->
<title>{pageTitle}</title>
<meta name="title" content={pageTitle} />
<meta name="description" content={description} />
<meta name="author" content={author} />

<!-- Robots -->
{noindex && <meta name="robots" content="noindex, nofollow" />}

<!-- Open Graph / Facebook -->
<meta property="og:type" content={article ? "article" : OG_CONFIG.type} />
<meta property="og:url" content={currentURL} />
<meta property="og:title" content={pageTitle} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImageURL} />
<meta property="og:image:width" content={OG_CONFIG.imageWidth.toString()} />
<meta property="og:image:height" content={OG_CONFIG.imageHeight.toString()} />
<meta property="og:site_name" content={OG_CONFIG.siteName} />
<meta property="og:locale" content={OG_CONFIG.locale} />

{
  article && pubDatetime && (
    <>
      <meta property="article:published_time" content={pubDatetime.toISOString()} />
      {modDatetime && (
        <meta property="article:modified_time" content={modDatetime.toISOString()} />
      )}
      <meta property="article:author" content={author} />
      {tags.map((tag) => (
        <meta property="article:tag" content={tag} />
      ))}
    </>
  )
}

<!-- Twitter Card -->
<meta name="twitter:card" content={TWITTER_CONFIG.card} />
<meta name="twitter:site" content={TWITTER_CONFIG.site} />
<meta name="twitter:creator" content={TWITTER_CONFIG.creator} />
<meta name="twitter:url" content={currentURL} />
<meta name="twitter:title" content={pageTitle} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImageURL} />

<!-- 主题颜色 -->
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#111827" />

<!-- 语言 -->
<meta name="language" content={SITE.lang} />
