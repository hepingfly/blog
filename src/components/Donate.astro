---
/**
 * æ‰“èµ/èµèµç»„ä»¶
 *
 * åŠŸèƒ½ï¼š
 * 1. æ˜¾ç¤ºä¸€ä¸ª"èµèµæ”¯æŒ"æŒ‰é’®
 * 2. ç‚¹å‡»æŒ‰é’®å¼¹å‡º Modal æ˜¾ç¤ºå¾®ä¿¡å’Œæ”¯ä»˜å®äºŒç»´ç 
 * 3. ä½¿ç”¨å ä½å›¾ç‰‡ï¼ŒåæœŸåªéœ€æ›¿æ¢å›¾ç‰‡å³å¯
 * 4. çº¯å‰ç«¯å®ç°ï¼Œæ— éœ€åç«¯æ”¯æŒ
 * 5. ä¸å½±å“ SEO å’Œé¡µé¢æ€§èƒ½
 *
 * å ä½å›¾ç‰‡è·¯å¾„ï¼š
 * - /src/assets/donate-qrcodes/wechat.png (å¾®ä¿¡èµèµç )
 * - /src/assets/donate-qrcodes/alipay.png (æ”¯ä»˜å®æ”¶æ¬¾ç )
 *
 * æ›´æ–°äºŒç»´ç æ–¹æ³•ï¼š
 * ç›´æ¥æ›¿æ¢ä¸Šè¿°è·¯å¾„çš„å›¾ç‰‡æ–‡ä»¶å³å¯ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
 */

import { getPath } from "../utils/getPath";

// å¯¼å…¥å ä½å›¾ç‰‡ï¼ˆå¦‚æœå›¾ç‰‡ä¸å­˜åœ¨ï¼Œå°†ä½¿ç”¨ fallbackï¼‰
// åæœŸæ›¿æ¢ä¸ºçœŸå®äºŒç»´ç æ—¶ï¼Œåªéœ€æ›¿æ¢å›¾ç‰‡æ–‡ä»¶
const wechatQRCode = getPath("donate-qrcodes/wechat.JPG");
const alipayQRCode = getPath("donate-qrcodes/alipay.JPG");
---

<div class="donate-wrapper">
  <!-- èµèµæŒ‰é’® -->
  <button
    id="donate-btn"
    class="btn btn-primary donate-btn"
    aria-label="èµèµæ”¯æŒ"
    title="å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿èµèµæ”¯æŒ"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="mr-2 h-5 w-5"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
      ></path>
    </svg>
    <span>èµèµæ”¯æŒ</span>
  </button>

  <!-- Modal å¼¹çª— -->
  <div
    id="donate-modal"
    class="donate-modal"
    role="dialog"
    aria-labelledby="donate-modal-title"
    aria-hidden="true"
  >
    <div class="donate-modal-backdrop" id="donate-modal-backdrop"></div>
    <div class="donate-modal-content">
      <!-- å…³é—­æŒ‰é’® -->
      <button id="donate-close-btn" class="donate-modal-close" aria-label="å…³é—­" title="å…³é—­">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="h-6 w-6"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>

      <!-- æ ‡é¢˜ -->
      <h3 id="donate-modal-title" class="donate-modal-title">æ„Ÿè°¢æ‚¨çš„æ”¯æŒ ğŸ™</h3>
      <p class="donate-modal-subtitle">å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿é€šè¿‡ä»¥ä¸‹æ–¹å¼èµèµæ”¯æŒ</p>

      <!-- äºŒç»´ç å±•ç¤ºåŒº -->
      <div class="donate-qrcode-container">
        <!-- å¾®ä¿¡èµèµç  -->
        <div class="donate-qrcode-item">
          <div class="donate-qrcode-box">
            <img
              src={wechatQRCode}
              alt="å¾®ä¿¡èµèµç "
              loading="lazy"
              onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f3f4f6%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22sans-serif%22 font-size=%2214%22 fill=%22%236b7280%22%3Eå¾®ä¿¡äºŒç»´ç %3C/text%3E%3C/svg%3E'"
            />
          </div>
          <div class="donate-qrcode-label">
            <svg class="donate-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
              <path
                fill="#07c160"
                d="M664.250054 368.541681c10.015098 0 19.892049 0.732687 29.67281 1.795902-26.647917-122.810047-159.358451-214.077703-310.826188-214.077703-169.353083 0-308.085774 114.232694-308.085774 259.274068 0 83.708494 46.165436 152.460344 123.281791 205.78483l-30.80868 91.730191 107.688651-53.455469c38.558178 7.53665 69.459978 15.308661 107.924012 15.308661 9.66308 0 19.230993-0.470721 28.752858-1.225921-6.025227-20.36584-9.521864-41.723264-9.521864-63.862493C402.328693 476.632491 517.908058 368.541681 664.250054 368.541681zM498.62897 285.87389c23.200398 0 38.557154 15.120372 38.557154 38.061874 0 22.846334-15.356756 38.156018-38.557154 38.156018-23.107277 0-46.260603-15.309684-46.260603-38.156018C452.368366 300.994262 475.522716 285.87389 498.62897 285.87389zM283.016307 362.091782c-23.107277 0-46.402843-15.309684-46.402843-38.156018 0-22.941502 23.295566-38.061874 46.402843-38.061874 23.081695 0 38.46301 15.120372 38.46301 38.061874C321.479317 346.782098 306.098002 362.091782 283.016307 362.091782zM945.448458 606.151333c0-121.888048-123.258255-221.236753-261.683954-221.236753-146.57838 0-262.015505 99.348706-262.015505 221.236753 0 122.06508 115.437126 221.200938 262.015505 221.200938 30.66644 0 61.617359-7.609305 92.423993-15.262612l84.513836 45.786813-23.178909-76.17082C899.379213 735.776599 945.448458 674.90216 945.448458 606.151333zM598.803483 567.994292c-15.332197 0-30.807656-15.096836-30.807656-30.501688 0-15.190981 15.47546-30.477129 30.807656-30.477129 23.295566 0 38.558178 15.286148 38.558178 30.477129C637.361661 552.897456 622.099049 567.994292 598.803483 567.994292zM768.25071 567.994292c-15.213493 0-30.594809-15.096836-30.594809-30.501688 0-15.190981 15.381315-30.477129 30.594809-30.477129 23.107277 0 38.558178 15.286148 38.558178 30.477129C806.808888 552.897456 791.357987 567.994292 768.25071 567.994292z"
              ></path>
            </svg>
            <span>å¾®ä¿¡èµèµ</span>
          </div>
        </div>

        <!-- æ”¯ä»˜å®æ”¶æ¬¾ç  -->
        <div class="donate-qrcode-item">
          <div class="donate-qrcode-box">
            <img
              src={alipayQRCode}
              alt="æ”¯ä»˜å®æ”¶æ¬¾ç "
              loading="lazy"
              onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22200%22 height=%22200%22%3E%3Crect width=%22200%22 height=%22200%22 fill=%22%23f3f4f6%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22sans-serif%22 font-size=%2214%22 fill=%22%236b7280%22%3Eæ”¯ä»˜å®äºŒç»´ç %3C/text%3E%3C/svg%3E'"
            />
          </div>
          <div class="donate-qrcode-label">
            <svg class="donate-icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg">
              <path
                fill="#1677ff"
                d="M439.88 563.85c57.17-124.93 72.88-232.09 72.88-232.09H348.81v-74.15h197.87v-76.36h84.27v76.84h198.92v73.67H664.04s-9.35 152.92-127.18 290.47c118.91 38.65 204.62 121.78 204.62 121.78l-68 83.33s-79.67-93.55-214.54-129.58A631.33 631.33 0 0 1 184.29 809.8L129 729.15c132.88 23.33 221.71-3.66 221.71-3.66 59.81-12.75 106.33-40.48 106.33-40.48s-17.47-38.35-37.16-121.16H213.92v-73.8h225.96z"
              ></path>
            </svg>
            <span>æ”¯ä»˜å®èµèµ</span>
          </div>
        </div>
      </div>

      <p class="donate-modal-footer">æ‚¨çš„æ”¯æŒæ˜¯æˆ‘æŒç»­åˆ›ä½œçš„åŠ¨åŠ› â¤ï¸</p>
    </div>
  </div>
</div>

<style>
  /* æ‰“èµæŒ‰é’®æ ·å¼ */
  .donate-wrapper {
    margin: 3rem 0;
    text-align: center;
  }

  .donate-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    padding: 0.75rem 1.5rem;
    transition: all 0.3s ease;
  }

  .donate-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
  }

  /* Modal æ ·å¼ */
  .donate-modal {
    position: fixed;
    inset: 0;
    z-index: 9999;
    display: none;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .donate-modal.active {
    display: flex;
    opacity: 1;
  }

  .donate-modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
  }

  .donate-modal-content {
    position: relative;
    background: rgb(var(--color-bg));
    border-radius: 1rem;
    padding: 2rem;
    max-width: 600px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow:
      0 20px 25px -5px rgba(0, 0, 0, 0.1),
      0 10px 10px -5px rgba(0, 0, 0, 0.04);
    animation: modalSlideIn 0.3s ease;
  }

  @keyframes modalSlideIn {
    from {
      transform: translateY(-20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .donate-modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.5rem;
    background: transparent;
    border: none;
    cursor: pointer;
    color: rgb(var(--color-text-base));
    transition: all 0.2s ease;
    border-radius: 0.5rem;
  }

  .donate-modal-close:hover {
    background: rgb(var(--color-fill));
    transform: rotate(90deg);
  }

  .donate-modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    text-align: center;
  }

  .donate-modal-subtitle {
    color: rgb(var(--color-text-base) / 0.7);
    text-align: center;
    margin-bottom: 2rem;
  }

  .donate-modal-footer {
    color: rgb(var(--color-text-base) / 0.6);
    text-align: center;
    margin-top: 2rem;
    font-size: 0.875rem;
  }

  /* äºŒç»´ç å®¹å™¨ */
  .donate-qrcode-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    margin: 2rem 0;
  }

  .donate-qrcode-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1rem;
  }

  .donate-qrcode-box {
    width: 200px;
    height: 200px;
    border: 2px solid rgb(var(--color-border));
    border-radius: 0.75rem;
    padding: 0.5rem;
    background: rgb(var(--color-bg-secondary));
    transition: all 0.3s ease;
  }

  .donate-qrcode-box:hover {
    transform: scale(1.05);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  }

  .donate-qrcode-box img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    border-radius: 0.5rem;
  }

  .donate-qrcode-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    font-size: 1rem;
  }

  .donate-icon {
    width: 32px;
    height: 32px;
  }

  /* å“åº”å¼è°ƒæ•´ */
  @media (max-width: 640px) {
    .donate-modal-content {
      padding: 1.5rem;
    }

    .donate-qrcode-container {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    .donate-qrcode-box {
      width: 180px;
      height: 180px;
    }
  }
</style>

<script>
  // Modal äº¤äº’é€»è¾‘
  function initDonateModal() {
    const donateBtn = document.getElementById("donate-btn");
    const modal = document.getElementById("donate-modal");
    const closeBtn = document.getElementById("donate-close-btn");
    const backdrop = document.getElementById("donate-modal-backdrop");

    if (!donateBtn || !modal || !closeBtn || !backdrop) return;

    // æ‰“å¼€ Modal
    function openModal() {
      if (!modal) return;
      modal.classList.add("active");
      modal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
    }

    // å…³é—­ Modal
    function closeModal() {
      if (!modal) return;
      modal.classList.remove("active");
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    // äº‹ä»¶ç›‘å¬
    donateBtn.addEventListener("click", openModal);
    closeBtn.addEventListener("click", closeModal);
    backdrop.addEventListener("click", closeModal);

    // ESC é”®å…³é—­
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal.classList.contains("active")) {
        closeModal();
      }
    });
  }

  // åˆå§‹åŒ–
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initDonateModal);
  } else {
    initDonateModal();
  }

  // æ”¯æŒ Astro View Transitions
  document.addEventListener("astro:page-load", initDonateModal);
</script>
